(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{bWLZ:function(t,o,e){"use strict";e.r(o),e.d(o,"AdminModule",(function(){return M}));var r=e("ofXK"),s=e("3Pt+"),i=e("6XRw"),n=e("tyNb"),b=e("fXoL"),u=e("iA8X");class a{static isbnFormat(t){if(!t.value)return null;const o=t.value.replace(/-/g,"");return/(^\d{10}$)|(^\d{13}$)/.test(o)?null:{isbnFormat:{valid:!1}}}static atLeastOneAuthor(t){return t.controls.some(t=>t.value)?null:{atLeastOneAuthor:{valid:!1}}}}var l=e("LRne"),c=e("lJxs"),m=e("JIr8");let h=(()=>{class t{constructor(t){this.bs=t}validate(t){return this.bs.check(t.value).pipe(Object(c.a)(t=>!1===t?null:{isbnExists:{valid:!1}}),Object(m.a)(()=>Object(l.a)(null)))}}return t.\u0275fac=function(o){return new(o||t)(b.Sb(u.a))},t.\u0275prov=b.Db({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function d(t,o){if(1&t&&(b.Mb(0,"div",1),b.mc(1),b.Lb()),2&t){const t=o.$implicit;b.xb(1),b.oc(" ",t,"\n")}}let f=(()=>{class t{constructor(){this.allMessages={title:{required:"Ein Buchtitel muss angegeben werden."},isbn:{required:"Es muss eine ISBN angegeben werden.",isbnFormat:"Die ISBN muss aus 10 oder 13 Zeichen bestehen.",isbnExists:"Die ISBN existiert bereits."},published:{required:"Es muss ein Erscheinungsdatum angegeben werden."},authors:{atLeastOneAuthor:"Es muss ein Autor angegeben werden."}}}ngOnInit(){}errorsForControl(){const t=this.allMessages[this.controlName];return this.control&&this.control.errors&&t&&this.control.dirty?Object.keys(this.control.errors).map(o=>t[o]):null}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=b.Bb({type:t,selectors:[["bm-form-messages"]],inputs:{control:"control",controlName:"controlName"},decls:1,vars:1,consts:[["class","ui negative message",4,"ngFor","ngForOf"],[1,"ui","negative","message"]],template:function(t,o){1&t&&b.kc(0,d,2,1,"div",0),2&t&&b.bc("ngForOf",o.errorsForControl())},directives:[r.j],styles:[""]}),t})();function p(t,o){if(1&t&&(b.Mb(0,"div",16),b.Ib(1,"input",17),b.Lb()),2&t){const t=o.index;b.xb(1),b.bc("formControlName",t)}}function g(t,o){1&t&&(b.Mb(0,"div",18),b.Mb(1,"div",19),b.Ib(2,"input",20),b.Lb(),b.Mb(3,"div",21),b.Ib(4,"input",22),b.Lb(),b.Lb()),2&t&&b.bc("formGroupName",o.index)}let k=(()=>{class t{constructor(t,o){this.fb=t,this.bookExistsValidator=o,this.editing=!1,this.submitBook=new b.n}ngOnInit(){this.initForm()}ngOnChanges(){this.initForm(),this.setFormValues(this.book)}setFormValues(t){this.bookForm.patchValue(t),this.bookForm.setControl("authors",this.buildAuthorsArray(t.authors)),this.bookForm.setControl("thumbnails",this.buildThumbnailsArray(t.thumbnails))}initForm(){this.bookForm||(this.bookForm=this.fb.group({title:["",s.q.required],subtitle:[""],isbn:[{value:"",disabled:this.editing},[s.q.required,a.isbnFormat],this.editing?null:[this.bookExistsValidator]],description:[""],authors:this.buildAuthorsArray([""]),thumbnails:this.buildThumbnailsArray([{title:"",url:""}]),published:[]}))}buildAuthorsArray(t){return this.fb.array(t,a.atLeastOneAuthor)}buildThumbnailsArray(t){return this.fb.array(t.map(t=>this.fb.group(t)))}get authors(){return this.bookForm.get("authors")}get thumbnails(){return this.bookForm.get("thumbnails")}addAuthorControl(){this.authors.push(this.fb.control(""))}addThumbnailControl(){this.thumbnails.push(this.fb.group({url:"",title:""}))}submitForm(){const t=this.bookForm.value,o=t.authors.filter(t=>t),e=t.thumbnails.filter(t=>t.url),r=this.editing?this.book.isbn:t.isbn,s=Object.assign(Object.assign({},t),{isbn:r,authors:o,thumbnails:e});this.submitBook.emit(s),this.bookForm.reset()}}return t.\u0275fac=function(o){return new(o||t)(b.Hb(s.c),b.Hb(h))},t.\u0275cmp=b.Bb({type:t,selectors:[["bm-book-form"]],inputs:{book:"book",editing:"editing"},outputs:{submitBook:"submitBook"},features:[b.vb],decls:34,vars:8,consts:[[1,"ui","form",3,"formGroup","ngSubmit"],["formControlName","title"],["controlName","title",3,"control"],["formControlName","subtitle"],["formControlName","isbn"],["controlName","isbn",3,"control"],["type","date","useValueAsDate","","formControlName","published"],["controlName","published",3,"control"],["type","button",1,"ui","mini","button",3,"click"],["formArrayName","authors",1,"fields"],["class","sixteen wide field",4,"ngFor","ngForOf"],["controlName","authors",3,"control"],["formControlName","description"],["formArrayName","thumbnails"],["class","fields",3,"formGroupName",4,"ngFor","ngForOf"],["type","submit",1,"ui","button",3,"disabled"],[1,"sixteen","wide","field"],["placeholder","Autor",3,"formControlName"],[1,"fields",3,"formGroupName"],[1,"nine","wide","field"],["placeholder","URL","formControlName","url"],[1,"seven","wide","field"],["placeholder","Titel","formControlName","title"]],template:function(t,o){1&t&&(b.Mb(0,"form",0),b.Vb("ngSubmit",(function(){return o.submitForm()})),b.Mb(1,"label"),b.mc(2,"Buchtitel"),b.Lb(),b.Ib(3,"input",1),b.Ib(4,"bm-form-messages",2),b.Mb(5,"label"),b.mc(6,"Untertitel"),b.Lb(),b.Ib(7,"input",3),b.Mb(8,"label"),b.mc(9,"ISBN"),b.Lb(),b.Ib(10,"input",4),b.Ib(11,"bm-form-messages",5),b.Mb(12,"label"),b.mc(13,"Erscheinungsdatum"),b.Lb(),b.Ib(14,"input",6),b.Ib(15,"bm-form-messages",7),b.Mb(16,"label"),b.mc(17,"Autoren"),b.Lb(),b.Mb(18,"button",8),b.Vb("click",(function(){return o.addAuthorControl()})),b.mc(19," + Autor "),b.Lb(),b.Mb(20,"div",9),b.kc(21,p,2,1,"div",10),b.Lb(),b.Ib(22,"bm-form-messages",11),b.Mb(23,"label"),b.mc(24,"Beschreibung"),b.Lb(),b.Ib(25,"textarea",12),b.Mb(26,"label"),b.mc(27,"Bilder"),b.Lb(),b.Mb(28,"button",8),b.Vb("click",(function(){return o.addThumbnailControl()})),b.mc(29," + Bild "),b.Lb(),b.Mb(30,"div",13),b.kc(31,g,5,1,"div",14),b.Lb(),b.Mb(32,"button",15),b.mc(33," Speichern "),b.Lb(),b.Lb()),2&t&&(b.bc("formGroup",o.bookForm),b.xb(4),b.bc("control",o.bookForm.get("title")),b.xb(7),b.bc("control",o.bookForm.get("isbn")),b.xb(4),b.bc("control",o.bookForm.get("published")),b.xb(6),b.bc("ngForOf",o.authors.controls),b.xb(1),b.bc("control",o.bookForm.get("authors")),b.xb(9),b.bc("ngForOf",o.thumbnails.controls),b.xb(1),b.bc("disabled",o.bookForm.invalid))},directives:[s.r,s.l,s.e,s.a,s.k,s.d,f,i.a,s.b,r.j,s.f],styles:[""]}),t})(),v=(()=>{class t{constructor(t,o,e){this.bs=t,this.route=o,this.router=e}ngOnInit(){}createBook(t){this.bs.create(t).subscribe(()=>{this.router.navigate(["../..","books"],{relativeTo:this.route})})}}return t.\u0275fac=function(o){return new(o||t)(b.Hb(u.a),b.Hb(n.a),b.Hb(n.d))},t.\u0275cmp=b.Bb({type:t,selectors:[["bm-create-book"]],decls:3,vars:0,consts:[[3,"submitBook"]],template:function(t,o){1&t&&(b.Mb(0,"h1"),b.mc(1,"Buch hinzuf\xfcgen"),b.Lb(),b.Mb(2,"bm-book-form",0),b.Vb("submitBook",(function(t){return o.createBook(t)})),b.Lb())},directives:[k],styles:[""]}),t})();var F=e("eIep");function L(t,o){if(1&t){const t=b.Nb();b.Mb(0,"bm-book-form",1),b.Vb("submitBook",(function(o){return b.gc(t),b.Xb().updateBook(o)})),b.Lb()}if(2&t){const t=b.Xb();b.bc("book",t.book)("editing",!0)}}const y=[{path:"",redirectTo:"create",pathMatch:"full"},{path:"create",component:v},{path:"edit/:isbn",component:(()=>{class t{constructor(t,o,e){this.bs=t,this.route=o,this.router=e}ngOnInit(){this.route.paramMap.pipe(Object(c.a)(t=>t.get("isbn")),Object(F.a)(t=>this.bs.getSingle(t))).subscribe(t=>this.book=t)}updateBook(t){this.bs.update(t).subscribe(()=>{this.router.navigate(["../../..","books",t.isbn],{relativeTo:this.route})})}}return t.\u0275fac=function(o){return new(o||t)(b.Hb(u.a),b.Hb(n.a),b.Hb(n.d))},t.\u0275cmp=b.Bb({type:t,selectors:[["bm-edit-book"]],decls:3,vars:1,consts:[[3,"book","editing","submitBook",4,"ngIf"],[3,"book","editing","submitBook"]],template:function(t,o){1&t&&(b.Mb(0,"h1"),b.mc(1,"Buch bearbeiten"),b.Lb(),b.kc(2,L,1,2,"bm-book-form",0)),2&t&&(b.xb(2),b.bc("ngIf",o.book))},directives:[r.k,k],styles:[""]}),t})()}];let B=(()=>{class t{}return t.\u0275mod=b.Fb({type:t}),t.\u0275inj=b.Eb({factory:function(o){return new(o||t)},providers:[],imports:[[n.h.forChild(y)],n.h]}),t})(),M=(()=>{class t{}return t.\u0275mod=b.Fb({type:t}),t.\u0275inj=b.Eb({factory:function(o){return new(o||t)},imports:[[r.c,B,s.o,i.b]]}),t})()}}]);