"use strict";(self.webpackChunkbook_monkey=self.webpackChunkbook_monkey||[]).push([[568],{7568:(Y,M,i)=>{i.r(M),i.d(M,{AdminModule:()=>D});var a=i(6019),s=i(9010),b=i(5956),m=i(828),o=i(865),d=i(727);class c{static isbnFormat(_){if(!_.value)return null;const e=_.value.replace(/-/g,"");return/(^\d{10}$)|(^\d{13}$)/.test(e)?null:{isbnFormat:{valid:!1}}}static atLeastOneAuthor(_){return _.controls.some(e=>e.value)?null:{atLeastOneAuthor:{valid:!1}}}}var h=i(2411),T=i(8053),k=i(2047);let I=(()=>{class t{constructor(e){this.bs=e}validate(e){return this.bs.check(e.value).pipe((0,T.U)(n=>!1===n?null:{isbnExists:{valid:!1}}),(0,k.K)(()=>(0,h.of)(null)))}}return t.\u0275fac=function(e){return new(e||t)(o.LFG(d.T))},t.\u0275prov=o.Yz7({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function F(t,_){if(1&t&&(o.TgZ(0,"div",1),o._uU(1),o.qZA()),2&t){const e=_.$implicit;o.xp6(1),o.hij(" ",e,"\n")}}let R=(()=>{class t{constructor(){this.allMessages={title:{required:"Ein Buchtitel muss angegeben werden."},isbn:{required:"Es muss eine ISBN angegeben werden.",isbnFormat:"Die ISBN muss aus 10 oder 13 Zeichen bestehen.",isbnExists:"Die ISBN existiert bereits."},published:{required:"Es muss ein Erscheinungsdatum angegeben werden."},authors:{atLeastOneAuthor:"Es muss ein Autor angegeben werden."}}}ngOnInit(){}errorsForControl(){const e=this.allMessages[this.controlName];return this.control&&this.control.errors&&e&&this.control.dirty?Object.keys(this.control.errors).map(n=>e[n]):[]}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=o.Xpm({type:t,selectors:[["bm-form-messages"]],inputs:{control:"control",controlName:"controlName"},decls:1,vars:1,consts:[["class","ui negative message",4,"ngFor","ngForOf"],[1,"ui","negative","message"]],template:function(e,n){1&e&&o.YNc(0,F,2,1,"div",0),2&e&&o.Q6J("ngForOf",n.errorsForControl())},directives:[a.sg],styles:[""]}),t})();function K(t,_){if(1&t&&(o.TgZ(0,"div",26),o._UZ(1,"input",27),o.qZA()),2&t){const e=_.index;o.xp6(1),o.Q6J("formControlName",e)}}function S(t,_){1&t&&(o.TgZ(0,"div",28),o.TgZ(1,"div",29),o._UZ(2,"input",30),o.qZA(),o.TgZ(3,"div",31),o._UZ(4,"input",32),o.qZA(),o.qZA()),2&t&&o.Q6J("formGroupName",_.index)}let g=(()=>{class t{constructor(e,n){this.fb=e,this.bookExistsValidator=n,this.submitBook=new o.vpe,this.bookForm=this.fb.group({title:["",s.kI.required],subtitle:[""],isbn:["",[s.kI.required,c.isbnFormat],r=>this.bookExistsValidator.validate(r)],description:[""],authors:this.buildAuthorsArray([""]),thumbnails:this.buildThumbnailsArray([{title:"",url:""}]),published:[new Date,[s.kI.required]]})}set editing(e){const n=this.bookForm.get("isbn");e?(n.clearAsyncValidators(),n.disable()):(n.setAsyncValidators(r=>this.bookExistsValidator.validate(r)),n.enable())}ngOnInit(){}ngOnChanges(){this.book&&this.setFormValues(this.book)}setFormValues(e){this.bookForm.patchValue(e),this.bookForm.setControl("authors",this.buildAuthorsArray(e.authors)),e.thumbnails&&this.bookForm.setControl("thumbnails",this.buildThumbnailsArray(e.thumbnails))}buildAuthorsArray(e){return this.fb.array(e,c.atLeastOneAuthor)}buildThumbnailsArray(e){return this.fb.array(e.map(n=>this.fb.group(n)))}get authors(){return this.bookForm.get("authors")}get thumbnails(){return this.bookForm.get("thumbnails")}addAuthorControl(){this.authors.push(this.fb.control(""))}addThumbnailControl(){this.thumbnails.push(this.fb.group({url:"",title:""}))}submitForm(){const e=this.bookForm.value,n=e.authors.filter(u=>u),r=e.thumbnails.filter(u=>u.url),O=this.book?this.book.isbn:e.isbn,N=Object.assign(Object.assign({},e),{isbn:O,authors:n,thumbnails:r});this.submitBook.emit(N),this.bookForm.reset()}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(s.qu),o.Y36(I))},t.\u0275cmp=o.Xpm({type:t,selectors:[["bm-book-form"]],inputs:{book:"book",editing:"editing"},outputs:{submitBook:"submitBook"},features:[o.TTD],decls:34,vars:8,consts:function(){let _,e,n,r,O,N,u,B,p,C,E,A,f;return _="Book Title",e="Subtitle",n="ISBN Number",r="Published Date",O="Authors",N="+ Author",u="Description",B="Thumbnails",p="+ Thumbnail",C="Save",E="Author",A="http://example_Url",f="Book Title",[[1,"ui","form",3,"formGroup","ngSubmit"],_,["formControlName","title"],["controlName","title",3,"control"],e,["formControlName","subtitle"],n,["formControlName","isbn"],["controlName","isbn",3,"control"],r,["type","date","useValueAsDate","","formControlName","published"],["controlName","published",3,"control"],O,["type","button",1,"ui","mini","button",3,"click"],N,["formArrayName","authors",1,"fields"],["class","sixteen wide field",4,"ngFor","ngForOf"],["controlName","authors",3,"control"],u,["formControlName","description"],B,p,["formArrayName","thumbnails"],["class","fields",3,"formGroupName",4,"ngFor","ngForOf"],["type","submit",1,"ui","button",3,"disabled"],C,[1,"sixteen","wide","field"],["placeholder",E,3,"formControlName"],[1,"fields",3,"formGroupName"],[1,"nine","wide","field"],["placeholder",A,"formControlName","url"],[1,"seven","wide","field"],["placeholder",f,"formControlName","title"]]},template:function(e,n){1&e&&(o.TgZ(0,"form",0),o.NdJ("ngSubmit",function(){return n.submitForm()}),o.TgZ(1,"label"),o.SDv(2,1),o.qZA(),o._UZ(3,"input",2),o._UZ(4,"bm-form-messages",3),o.TgZ(5,"label"),o.SDv(6,4),o.qZA(),o._UZ(7,"input",5),o.TgZ(8,"label"),o.SDv(9,6),o.qZA(),o._UZ(10,"input",7),o._UZ(11,"bm-form-messages",8),o.TgZ(12,"label"),o.SDv(13,9),o.qZA(),o._UZ(14,"input",10),o._UZ(15,"bm-form-messages",11),o.TgZ(16,"label"),o.SDv(17,12),o.qZA(),o.TgZ(18,"button",13),o.NdJ("click",function(){return n.addAuthorControl()}),o.SDv(19,14),o.qZA(),o.TgZ(20,"div",15),o.YNc(21,K,2,1,"div",16),o.qZA(),o._UZ(22,"bm-form-messages",17),o.TgZ(23,"label"),o.SDv(24,18),o.qZA(),o._UZ(25,"textarea",19),o.TgZ(26,"label"),o.SDv(27,20),o.qZA(),o.TgZ(28,"button",13),o.NdJ("click",function(){return n.addThumbnailControl()}),o.SDv(29,21),o.qZA(),o.TgZ(30,"div",22),o.YNc(31,S,5,1,"div",23),o.qZA(),o.TgZ(32,"button",24),o.SDv(33,25),o.qZA(),o.qZA()),2&e&&(o.Q6J("formGroup",n.bookForm),o.xp6(4),o.Q6J("control",n.bookForm.get("title")),o.xp6(7),o.Q6J("control",n.bookForm.get("isbn")),o.xp6(4),o.Q6J("control",n.bookForm.get("published")),o.xp6(6),o.Q6J("ngForOf",n.authors.controls),o.xp6(1),o.Q6J("control",n.bookForm.get("authors")),o.xp6(9),o.Q6J("ngForOf",n.thumbnails.controls),o.xp6(1),o.Q6J("disabled",n.bookForm.invalid))},directives:[s._Y,s.JL,s.sg,s.Fj,s.JJ,s.u,R,b.hR,s.CE,a.sg,s.x0],styles:[""]}),t})(),P=(()=>{class t{constructor(e,n,r){this.bs=e,this.route=n,this.router=r}ngOnInit(){}createBook(e){this.bs.create(e).subscribe(()=>{this.router.navigate(["../..","books"],{relativeTo:this.route})})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(d.T),o.Y36(m.gz),o.Y36(m.F0))},t.\u0275cmp=o.Xpm({type:t,selectors:[["bm-create-book"]],decls:3,vars:0,consts:function(){let _;return _="Book Form",[_,[3,"submitBook"]]},template:function(e,n){1&e&&(o.TgZ(0,"h1"),o.SDv(1,0),o.qZA(),o.TgZ(2,"bm-book-form",1),o.NdJ("submitBook",function(O){return n.createBook(O)}),o.qZA())},directives:[g],styles:[""]}),t})();var $=i(9204);function v(t,_){if(1&t){const e=o.EpF();o.TgZ(0,"bm-book-form",2),o.NdJ("submitBook",function(r){return o.CHM(e),o.oxw().updateBook(r)}),o.qZA()}if(2&t){const e=o.oxw();o.Q6J("book",e.book)("editing",!0)}}const Z=[{path:"",redirectTo:"create",pathMatch:"full"},{path:"create",component:P},{path:"edit/:isbn",component:(()=>{class t{constructor(e,n,r){this.bs=e,this.route=n,this.router=r}ngOnInit(){this.route.paramMap.pipe((0,T.U)(e=>e.get("isbn")||""),(0,$.w)(e=>this.bs.getSingle(e))).subscribe(e=>this.book=e)}updateBook(e){this.bs.update(e).subscribe(()=>{this.router.navigate(["../../..","books",e.isbn],{relativeTo:this.route})})}}return t.\u0275fac=function(e){return new(e||t)(o.Y36(d.T),o.Y36(m.gz),o.Y36(m.F0))},t.\u0275cmp=o.Xpm({type:t,selectors:[["bm-edit-book"]],decls:3,vars:1,consts:function(){let _;return _="Book Form",[_,[3,"book","editing","submitBook",4,"ngIf"],[3,"book","editing","submitBook"]]},template:function(e,n){1&e&&(o.TgZ(0,"h1"),o.SDv(1,0),o.qZA(),o.YNc(2,v,1,2,"bm-book-form",1)),2&e&&(o.xp6(2),o.Q6J("ngIf",n.book))},directives:[a.O5,g],styles:[""]}),t})()}];let y=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({providers:[],imports:[[m.Bz.forChild(Z)],m.Bz]}),t})(),D=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.oAB({type:t}),t.\u0275inj=o.cJS({imports:[[a.ez,y,s.UX,b.B_]]}),t})()}}]);