(self.webpackChunkbook_monkey=self.webpackChunkbook_monkey||[]).push([[44],{1044:(o,t,e)=>{"use strict";e.r(t),e.d(t,{AdminModule:()=>C});var r=e(1116),s=e(1462),n=e(1017),i=e(1441),l=e(8619),a=e(8912);class u{static isbnFormat(o){if(!o.value)return null;const t=o.value.replace(/-/g,"");return/(^\d{10}$)|(^\d{13}$)/.test(t)?null:{isbnFormat:{valid:!1}}}static atLeastOneAuthor(o){return o.controls.some(o=>o.value)?null:{atLeastOneAuthor:{valid:!1}}}}var m=e(878),b=e(9996),c=e(7727);let h=(()=>{class o{constructor(o){this.bs=o}validate(o){return this.bs.check(o.value).pipe((0,b.U)(o=>!1===o?null:{isbnExists:{valid:!1}}),(0,c.K)(()=>(0,m.of)(null)))}}return o.\u0275fac=function(t){return new(t||o)(l.LFG(a.T))},o.\u0275prov=l.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();function d(o,t){if(1&o&&(l.TgZ(0,"div",1),l._uU(1),l.qZA()),2&o){const o=t.$implicit;l.xp6(1),l.hij(" ",o,"\n")}}let p=(()=>{class o{constructor(){this.allMessages={title:{required:"Ein Buchtitel muss angegeben werden."},isbn:{required:"Es muss eine ISBN angegeben werden.",isbnFormat:"Die ISBN muss aus 10 oder 13 Zeichen bestehen.",isbnExists:"Die ISBN existiert bereits."},published:{required:"Es muss ein Erscheinungsdatum angegeben werden."},authors:{atLeastOneAuthor:"Es muss ein Autor angegeben werden."}}}ngOnInit(){}errorsForControl(){const o=this.allMessages[this.controlName];return this.control&&this.control.errors&&o&&this.control.dirty?Object.keys(this.control.errors).map(t=>o[t]):[]}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=l.Xpm({type:o,selectors:[["bm-form-messages"]],inputs:{control:"control",controlName:"controlName"},decls:1,vars:1,consts:[["class","ui negative message",4,"ngFor","ngForOf"],[1,"ui","negative","message"]],template:function(o,t){1&o&&l.YNc(0,d,2,1,"div",0),2&o&&l.Q6J("ngForOf",t.errorsForControl())},directives:[r.sg],styles:[""]}),o})();function f(o,t){if(1&o&&(l.TgZ(0,"div",26),l._UZ(1,"input",27),l.qZA()),2&o){const o=t.index;l.xp6(1),l.Q6J("formControlName",o)}}function g(o,t){1&o&&(l.TgZ(0,"div",28),l.TgZ(1,"div",29),l._UZ(2,"input",30),l.qZA(),l.TgZ(3,"div",31),l._UZ(4,"input",32),l.qZA(),l.qZA()),2&o&&l.Q6J("formGroupName",t.index)}let k=(()=>{class o{constructor(o,t){this.fb=o,this.bookExistsValidator=t,this.submitBook=new l.vpe,this.bookForm=this.fb.group({title:["",s.kI.required],subtitle:[""],isbn:["",[s.kI.required,u.isbnFormat],o=>this.bookExistsValidator.validate(o)],description:[""],authors:this.buildAuthorsArray([""]),thumbnails:this.buildThumbnailsArray([{title:"",url:""}]),published:[]})}set editing(o){const t=this.bookForm.get("isbn");o?(t.clearAsyncValidators(),t.disable()):(t.setAsyncValidators(o=>this.bookExistsValidator.validate(o)),t.enable())}ngOnInit(){}ngOnChanges(){this.book&&this.setFormValues(this.book)}setFormValues(o){this.bookForm.patchValue(o),this.bookForm.setControl("authors",this.buildAuthorsArray(o.authors)),o.thumbnails&&this.bookForm.setControl("thumbnails",this.buildThumbnailsArray(o.thumbnails))}buildAuthorsArray(o){return this.fb.array(o,u.atLeastOneAuthor)}buildThumbnailsArray(o){return this.fb.array(o.map(o=>this.fb.group(o)))}get authors(){return this.bookForm.get("authors")}get thumbnails(){return this.bookForm.get("thumbnails")}addAuthorControl(){this.authors.push(this.fb.control(""))}addThumbnailControl(){this.thumbnails.push(this.fb.group({url:"",title:""}))}submitForm(){const o=this.bookForm.value,t=o.authors.filter(o=>o),e=o.thumbnails.filter(o=>o.url),r=this.book?this.book.isbn:o.isbn,s=Object.assign(Object.assign({},o),{isbn:r,authors:t,thumbnails:e});this.submitBook.emit(s),this.bookForm.reset()}}return o.\u0275fac=function(t){return new(t||o)(l.Y36(s.qu),l.Y36(h))},o.\u0275cmp=l.Xpm({type:o,selectors:[["bm-book-form"]],inputs:{book:"book",editing:"editing"},outputs:{submitBook:"submitBook"},features:[l.TTD],decls:34,vars:8,consts:function(){let o,t,e,r,s,n,i,l,a,u,m,b,c;return o="Book Title",t="Subtitle",e="ISBN Number",r="Published Date",s="Authors",n="+ Author",i="Description",l="Thumbnails",a="+ Thumbnail",u="Save",m="Author",b="http://example_Url",c="Book Title",[[1,"ui","form",3,"formGroup","ngSubmit"],o,["formControlName","title"],["controlName","title",3,"control"],t,["formControlName","subtitle"],e,["formControlName","isbn"],["controlName","isbn",3,"control"],r,["type","date","useValueAsDate","","formControlName","published"],["controlName","published",3,"control"],s,["type","button",1,"ui","mini","button",3,"click"],n,["formArrayName","authors",1,"fields"],["class","sixteen wide field",4,"ngFor","ngForOf"],["controlName","authors",3,"control"],i,["formControlName","description"],l,a,["formArrayName","thumbnails"],["class","fields",3,"formGroupName",4,"ngFor","ngForOf"],["type","submit",1,"ui","button",3,"disabled"],u,[1,"sixteen","wide","field"],["placeholder",m,3,"formControlName"],[1,"fields",3,"formGroupName"],[1,"nine","wide","field"],["placeholder",b,"formControlName","url"],[1,"seven","wide","field"],["placeholder",c,"formControlName","title"]]},template:function(o,t){1&o&&(l.TgZ(0,"form",0),l.NdJ("ngSubmit",function(){return t.submitForm()}),l.TgZ(1,"label"),l.SDv(2,1),l.qZA(),l._UZ(3,"input",2),l._UZ(4,"bm-form-messages",3),l.TgZ(5,"label"),l.SDv(6,4),l.qZA(),l._UZ(7,"input",5),l.TgZ(8,"label"),l.SDv(9,6),l.qZA(),l._UZ(10,"input",7),l._UZ(11,"bm-form-messages",8),l.TgZ(12,"label"),l.SDv(13,9),l.qZA(),l._UZ(14,"input",10),l._UZ(15,"bm-form-messages",11),l.TgZ(16,"label"),l.SDv(17,12),l.qZA(),l.TgZ(18,"button",13),l.NdJ("click",function(){return t.addAuthorControl()}),l.SDv(19,14),l.qZA(),l.TgZ(20,"div",15),l.YNc(21,f,2,1,"div",16),l.qZA(),l._UZ(22,"bm-form-messages",17),l.TgZ(23,"label"),l.SDv(24,18),l.qZA(),l._UZ(25,"textarea",19),l.TgZ(26,"label"),l.SDv(27,20),l.qZA(),l.TgZ(28,"button",13),l.NdJ("click",function(){return t.addThumbnailControl()}),l.SDv(29,21),l.qZA(),l.TgZ(30,"div",22),l.YNc(31,g,5,1,"div",23),l.qZA(),l.TgZ(32,"button",24),l.SDv(33,25),l.qZA(),l.qZA()),2&o&&(l.Q6J("formGroup",t.bookForm),l.xp6(4),l.Q6J("control",t.bookForm.get("title")),l.xp6(7),l.Q6J("control",t.bookForm.get("isbn")),l.xp6(4),l.Q6J("control",t.bookForm.get("published")),l.xp6(6),l.Q6J("ngForOf",t.authors.controls),l.xp6(1),l.Q6J("control",t.bookForm.get("authors")),l.xp6(9),l.Q6J("ngForOf",t.thumbnails.controls),l.xp6(1),l.Q6J("disabled",t.bookForm.invalid))},directives:[s._Y,s.JL,s.sg,s.Fj,s.JJ,s.u,p,n.hR,s.CE,r.sg,s.x0],styles:[""]}),o})(),v=(()=>{class o{constructor(o,t,e){this.bs=o,this.route=t,this.router=e}ngOnInit(){}createBook(o){this.bs.create(o).subscribe(()=>{this.router.navigate(["../..","books"],{relativeTo:this.route})})}}return o.\u0275fac=function(t){return new(t||o)(l.Y36(a.T),l.Y36(i.gz),l.Y36(i.F0))},o.\u0275cmp=l.Xpm({type:o,selectors:[["bm-create-book"]],decls:3,vars:0,consts:function(){let o;return o="Book Form",[o,[3,"submitBook"]]},template:function(o,t){1&o&&(l.TgZ(0,"h1"),l.SDv(1,0),l.qZA(),l.TgZ(2,"bm-book-form",1),l.NdJ("submitBook",function(o){return t.createBook(o)}),l.qZA())},directives:[k],styles:[""]}),o})();var Z=e(4689);function F(o,t){if(1&o){const o=l.EpF();l.TgZ(0,"bm-book-form",2),l.NdJ("submitBook",function(t){return l.CHM(o),l.oxw().updateBook(t)}),l.qZA()}if(2&o){const o=l.oxw();l.Q6J("book",o.book)("editing",!0)}}const A=[{path:"",redirectTo:"create",pathMatch:"full"},{path:"create",component:v},{path:"edit/:isbn",component:(()=>{class o{constructor(o,t,e){this.bs=o,this.route=t,this.router=e}ngOnInit(){this.route.paramMap.pipe((0,b.U)(o=>o.get("isbn")||""),(0,Z.w)(o=>this.bs.getSingle(o))).subscribe(o=>this.book=o)}updateBook(o){this.bs.update(o).subscribe(()=>{this.router.navigate(["../../..","books",o.isbn],{relativeTo:this.route})})}}return o.\u0275fac=function(t){return new(t||o)(l.Y36(a.T),l.Y36(i.gz),l.Y36(i.F0))},o.\u0275cmp=l.Xpm({type:o,selectors:[["bm-edit-book"]],decls:3,vars:1,consts:function(){let o;return o="Book Form",[o,[3,"book","editing","submitBook",4,"ngIf"],[3,"book","editing","submitBook"]]},template:function(o,t){1&o&&(l.TgZ(0,"h1"),l.SDv(1,0),l.qZA(),l.YNc(2,F,1,2,"bm-book-form",1)),2&o&&(l.xp6(2),l.Q6J("ngIf",t.book))},directives:[r.O5,k],styles:[""]}),o})()}];let B=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({providers:[],imports:[[i.Bz.forChild(A)],i.Bz]}),o})(),C=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[[r.ez,B,s.UX,n.B_]]}),o})()}}]);