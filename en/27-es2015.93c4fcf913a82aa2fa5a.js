(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{el1n:function(t,o,e){"use strict";e.r(o),e.d(o,"AdminModule",(function(){return B}));var r=e("ofXK"),s=e("3Pt+"),i=e("6XRw"),n=e("tyNb"),b=e("fXoL"),u=e("a3UO");class a{static isbnFormat(t){if(!t.value)return null;const o=t.value.replace(/-/g,"");return/(^\d{10}$)|(^\d{13}$)/.test(o)?null:{isbnFormat:{valid:!1}}}static atLeastOneAuthor(t){return t.controls.some(t=>t.value)?null:{atLeastOneAuthor:{valid:!1}}}}var l=e("LRne"),c=e("lJxs"),m=e("JIr8");let h=(()=>{class t{constructor(t){this.bs=t}validate(t){return this.bs.check(t.value).pipe(Object(c.a)(t=>!1===t?null:{isbnExists:{valid:!1}}),Object(m.a)(()=>Object(l.a)(null)))}}return t.\u0275fac=function(o){return new(o||t)(b.Ub(u.a))},t.\u0275prov=b.Fb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function d(t,o){if(1&t&&(b.Ob(0,"div",1),b.pc(1),b.Nb()),2&t){const t=o.$implicit;b.zb(1),b.rc(" ",t,"\n")}}let f=(()=>{class t{constructor(){this.allMessages={title:{required:"Ein Buchtitel muss angegeben werden."},isbn:{required:"Es muss eine ISBN angegeben werden.",isbnFormat:"Die ISBN muss aus 10 oder 13 Zeichen bestehen.",isbnExists:"Die ISBN existiert bereits."},published:{required:"Es muss ein Erscheinungsdatum angegeben werden."},authors:{atLeastOneAuthor:"Es muss ein Autor angegeben werden."}}}ngOnInit(){}errorsForControl(){const t=this.allMessages[this.controlName];return this.control&&this.control.errors&&t&&this.control.dirty?Object.keys(this.control.errors).map(o=>t[o]):null}}return t.\u0275fac=function(o){return new(o||t)},t.\u0275cmp=b.Db({type:t,selectors:[["bm-form-messages"]],inputs:{control:"control",controlName:"controlName"},decls:1,vars:1,consts:[["class","ui negative message",4,"ngFor","ngForOf"],[1,"ui","negative","message"]],template:function(t,o){1&t&&b.nc(0,d,2,1,"div",0),2&t&&b.ec("ngForOf",o.errorsForControl())},directives:[r.j],styles:[""]}),t})();function p(t,o){if(1&t&&(b.Ob(0,"div",16),b.Kb(1,"input",17),b.Nb()),2&t){const t=o.index;b.zb(1),b.ec("formControlName",t)}}function g(t,o){1&t&&(b.Ob(0,"div",18),b.Ob(1,"div",19),b.Kb(2,"input",20),b.Nb(),b.Ob(3,"div",21),b.Kb(4,"input",22),b.Nb(),b.Nb()),2&t&&b.ec("formGroupName",o.index)}let k=(()=>{class t{constructor(t,o){this.fb=t,this.bookExistsValidator=o,this.editing=!1,this.submitBook=new b.n}ngOnInit(){this.initForm()}ngOnChanges(){this.initForm(),this.setFormValues(this.book)}setFormValues(t){this.bookForm.patchValue(t),this.bookForm.setControl("authors",this.buildAuthorsArray(t.authors)),this.bookForm.setControl("thumbnails",this.buildThumbnailsArray(t.thumbnails))}initForm(){this.bookForm||(this.bookForm=this.fb.group({title:["",s.q.required],subtitle:[""],isbn:[{value:"",disabled:this.editing},[s.q.required,a.isbnFormat],this.editing?null:[this.bookExistsValidator]],description:[""],authors:this.buildAuthorsArray([""]),thumbnails:this.buildThumbnailsArray([{title:"",url:""}]),published:[]}))}buildAuthorsArray(t){return this.fb.array(t,a.atLeastOneAuthor)}buildThumbnailsArray(t){return this.fb.array(t.map(t=>this.fb.group(t)))}get authors(){return this.bookForm.get("authors")}get thumbnails(){return this.bookForm.get("thumbnails")}addAuthorControl(){this.authors.push(this.fb.control(""))}addThumbnailControl(){this.thumbnails.push(this.fb.group({url:"",title:""}))}submitForm(){const t=this.bookForm.value,o=t.authors.filter(t=>t),e=t.thumbnails.filter(t=>t.url),r=this.editing?this.book.isbn:t.isbn,s=Object.assign(Object.assign({},t),{isbn:r,authors:o,thumbnails:e});this.submitBook.emit(s),this.bookForm.reset()}}return t.\u0275fac=function(o){return new(o||t)(b.Jb(s.c),b.Jb(h))},t.\u0275cmp=b.Db({type:t,selectors:[["bm-book-form"]],inputs:{book:"book",editing:"editing"},outputs:{submitBook:"submitBook"},features:[b.xb],decls:34,vars:8,consts:[[1,"ui","form",3,"formGroup","ngSubmit"],["formControlName","title"],["controlName","title",3,"control"],["formControlName","subtitle"],["formControlName","isbn"],["controlName","isbn",3,"control"],["type","date","useValueAsDate","","formControlName","published"],["controlName","published",3,"control"],["type","button",1,"ui","mini","button",3,"click"],["formArrayName","authors",1,"fields"],["class","sixteen wide field",4,"ngFor","ngForOf"],["controlName","authors",3,"control"],["formControlName","description"],["formArrayName","thumbnails"],["class","fields",3,"formGroupName",4,"ngFor","ngForOf"],["type","submit",1,"ui","button",3,"disabled"],[1,"sixteen","wide","field"],["placeholder","Autor",3,"formControlName"],[1,"fields",3,"formGroupName"],[1,"nine","wide","field"],["placeholder","URL","formControlName","url"],[1,"seven","wide","field"],["placeholder","Titel","formControlName","title"]],template:function(t,o){1&t&&(b.Ob(0,"form",0),b.Yb("ngSubmit",(function(){return o.submitForm()})),b.Ob(1,"label"),b.pc(2,"Buchtitel"),b.Nb(),b.Kb(3,"input",1),b.Kb(4,"bm-form-messages",2),b.Ob(5,"label"),b.pc(6,"Untertitel"),b.Nb(),b.Kb(7,"input",3),b.Ob(8,"label"),b.pc(9,"ISBN"),b.Nb(),b.Kb(10,"input",4),b.Kb(11,"bm-form-messages",5),b.Ob(12,"label"),b.pc(13,"Erscheinungsdatum"),b.Nb(),b.Kb(14,"input",6),b.Kb(15,"bm-form-messages",7),b.Ob(16,"label"),b.pc(17,"Autoren"),b.Nb(),b.Ob(18,"button",8),b.Yb("click",(function(){return o.addAuthorControl()})),b.pc(19," + Autor "),b.Nb(),b.Ob(20,"div",9),b.nc(21,p,2,1,"div",10),b.Nb(),b.Kb(22,"bm-form-messages",11),b.Ob(23,"label"),b.pc(24,"Beschreibung"),b.Nb(),b.Kb(25,"textarea",12),b.Ob(26,"label"),b.pc(27,"Bilder"),b.Nb(),b.Ob(28,"button",8),b.Yb("click",(function(){return o.addThumbnailControl()})),b.pc(29," + Bild "),b.Nb(),b.Ob(30,"div",13),b.nc(31,g,5,1,"div",14),b.Nb(),b.Ob(32,"button",15),b.pc(33," Speichern "),b.Nb(),b.Nb()),2&t&&(b.ec("formGroup",o.bookForm),b.zb(4),b.ec("control",o.bookForm.get("title")),b.zb(7),b.ec("control",o.bookForm.get("isbn")),b.zb(4),b.ec("control",o.bookForm.get("published")),b.zb(6),b.ec("ngForOf",o.authors.controls),b.zb(1),b.ec("control",o.bookForm.get("authors")),b.zb(9),b.ec("ngForOf",o.thumbnails.controls),b.zb(1),b.ec("disabled",o.bookForm.invalid))},directives:[s.r,s.l,s.e,s.a,s.k,s.d,f,i.a,s.b,r.j,s.f],styles:[""]}),t})(),N=(()=>{class t{constructor(t,o,e){this.bs=t,this.route=o,this.router=e}ngOnInit(){}createBook(t){this.bs.create(t).subscribe(()=>{this.router.navigate(["../..","books"],{relativeTo:this.route})})}}return t.\u0275fac=function(o){return new(o||t)(b.Jb(u.a),b.Jb(n.a),b.Jb(n.d))},t.\u0275cmp=b.Db({type:t,selectors:[["bm-create-book"]],decls:3,vars:0,consts:[[3,"submitBook"]],template:function(t,o){1&t&&(b.Ob(0,"h1"),b.pc(1,"Buch hinzuf\xfcgen"),b.Nb(),b.Ob(2,"bm-book-form",0),b.Yb("submitBook",(function(t){return o.createBook(t)})),b.Nb())},directives:[k],styles:[""]}),t})();var O=e("eIep");function v(t,o){if(1&t){const t=b.Pb();b.Ob(0,"bm-book-form",1),b.Yb("submitBook",(function(o){return b.jc(t),b.ac().updateBook(o)})),b.Nb()}if(2&t){const t=b.ac();b.ec("book",t.book)("editing",!0)}}const F=[{path:"",redirectTo:"create",pathMatch:"full"},{path:"create",component:N},{path:"edit/:isbn",component:(()=>{class t{constructor(t,o,e){this.bs=t,this.route=o,this.router=e}ngOnInit(){this.route.paramMap.pipe(Object(c.a)(t=>t.get("isbn")),Object(O.a)(t=>this.bs.getSingle(t))).subscribe(t=>this.book=t)}updateBook(t){this.bs.update(t).subscribe(()=>{this.router.navigate(["../../..","books",t.isbn],{relativeTo:this.route})})}}return t.\u0275fac=function(o){return new(o||t)(b.Jb(u.a),b.Jb(n.a),b.Jb(n.d))},t.\u0275cmp=b.Db({type:t,selectors:[["bm-edit-book"]],decls:3,vars:1,consts:[[3,"book","editing","submitBook",4,"ngIf"],[3,"book","editing","submitBook"]],template:function(t,o){1&t&&(b.Ob(0,"h1"),b.pc(1,"Buch bearbeiten"),b.Nb(),b.nc(2,v,1,2,"bm-book-form",0)),2&t&&(b.zb(2),b.ec("ngIf",o.book))},directives:[r.k,k],styles:[""]}),t})()}];let y=(()=>{class t{}return t.\u0275mod=b.Hb({type:t}),t.\u0275inj=b.Gb({factory:function(o){return new(o||t)},providers:[],imports:[[n.h.forChild(F)],n.h]}),t})(),B=(()=>{class t{}return t.\u0275mod=b.Hb({type:t}),t.\u0275inj=b.Gb({factory:function(o){return new(o||t)},imports:[[r.c,y,s.o,i.b]]}),t})()}}]);